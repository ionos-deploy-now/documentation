<template>
  <Layout>
    <div class="container">
      <h1 class="pl-8">{{ $t('blog.title') }}</h1>
      <div class="hidden md:grid grid-cols-2 gap-8">
        <div class="space-y-8">
          <BlogTeaser v-for="post in groupedBlogPosts.left" :key="post.path" :post="post" />
        </div>
        <div class="space-y-8 transform translate-y-16">
          <BlogTeaser v-for="post in groupedBlogPosts.right" :key="post.path" :post="post" />
        </div>
      </div>
      <div class="md:hidden grid grid-cols-1 gap-4">
        <BlogTeaser v-for="post in sortedBlogPosts" :key="post.path" :post="post" />
      </div>
    </div>
  </Layout>
</template>

<page-query>
query {
  allMarkdownPage(filter: { contentType: { eq: "blog" } }) {
    edges {
      node {
        path
        title
        teaser
        excerpt
        description
        contentType
        timeToRead
        tags
        author
        createdAt
        hidden
      }
    }
  }
}
</page-query>

<script>
import BlogTeaser from '~/components/BlogTeaser';
import { checkForPrivacyConsent, STATISTICS } from "../libs/privacy-consent";

export default {
  components: {
    BlogTeaser,
  },
  methods: {
    loadPixelTracking() {
      console.log('load pixel tracking');
    },
  },
  computed: {
    sortedBlogPosts() {
      return this.$page.allMarkdownPage.edges
        .map(edge => edge.node)
        .filter(node => !node.hidden)
        .sort((a, b) => b.createdAt - a.createdAt);
    },
    groupedBlogPosts() {
      return this.sortedBlogPosts.reduce((acc, post, i) => {
        if (i % 2 === 0) {
          acc.left.push(post);
        } else {
          acc.right.push(post);
        }
        return acc;
      }, { left: [], right: [] });
    },
  },
  metaInfo() {
    return {
      title: 'Blog',
      script: [
        {
          src: 'https://var.uicdn.net/shopsshort/privacy/v1/bundle.js',
          body: true,
          callback: () => checkForPrivacyConsent(STATISTICS, this.loadPixelTracking),
        },
      ],
      link: [
        {
          rel: 'stylesheet',
          href: 'https://var.uicdn.net/shopsshort/privacy/v1/bundle.css',
        },
      ],
    }
  },
};
</script>
